<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Werkzeug + Unix sockets by tomekwojcik</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/tomekwojcik/werkzeug_plus_unix_sockets">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/tomekwojcik/werkzeug_plus_unix_sockets/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/tomekwojcik/werkzeug_plus_unix_sockets/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Werkzeug + Unix sockets</h1>
          <p>Monkey-patching Werkzeug WSGI server to use Unix sockets instead of TCP sockets.</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/tomekwojcik">tomekwojcik</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h2>
<a name="why" class="anchor" href="#why"><span class="octicon octicon-link"></span></a>Why?</h2>

<p>Because I was tired of having to deal with looking for free TCP ports for my
Flask development servers. Using Unix sockets is much simpler and fun.</p>

<h2>
<a name="how" class="anchor" href="#how"><span class="octicon octicon-link"></span></a>How?</h2>

<p>Here's a quick guide to using Werkzeug + Unix sockets in a Flask app.</p>

<p>First, install the module:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>pip install git+git://github.com/tomekwojcik/werkzeug_plus_unix_sockets.git
</pre></div>

<p>Then, adapt your app to use it:</p>

<div class="highlight highlight-python"><pre><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">app_index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">'Hello, World!'</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">werkzeug_unix_sock</span> <span class="kn">import</span> <span class="n">patch_werkzeug</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c"># Falling back to TCP socket.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">patch_werkzeug</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s">'/tmp/unix_sock_demo.app.sock'</span><span class="p">)</span> <span class="c"># Using Unix socket.</span>
</pre></div>

<p>Finally, you'll have to adapt your nginx config:</p>

<div class="highlight highlight-Nginx"><pre><span class="k">server</span> <span class="p">{</span>
    <span class="kn">server_name</span> <span class="s">unix_sock_demo.app</span><span class="p">;</span>
    <span class="kn">listen</span>      <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">80</span><span class="p">;</span>

    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span>  <span class="s">http://unix:/tmp/unix_sock_demo.app.sock:</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Restart nginx, start your app and test it:</p>

<div class="highlight highlight-bash"><pre>bilbo ~ <span class="nv">$ </span>http -v GET http://unix_sock_demo.app/
GET / HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate, compress
Host: unix_sock_demo.app
User-Agent: HTTPie/0.7.2



HTTP/1.1 200 OK
Connection: keep-alive
Content-Length: 13
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>utf-8
Date: Sun, 05 Jan 2014 12:49:30 GMT
Server: nginx/1.4.2

Hello, World!
</pre></div>

<h2>
<a name="will-it-work-with-my-flask-app" class="anchor" href="#will-it-work-with-my-flask-app"><span class="octicon octicon-link"></span></a>Will it work with my Flask app?</h2>

<p>It works with mine Flask apps, so it should work with yours, too. I can't
guarantee anything, though. I tested it with a few Flask apps of
mine, each one using <code>Werkzeug==0.9.4</code>.</p>

<p>Since this is an ugly hack all I can say that your mileage may vary.</p>

<h2>
<a name="anything-else" class="anchor" href="#anything-else"><span class="octicon octicon-link"></span></a>Anything else?</h2>

<p>This hack was done by <a href="http://www.bthlabs.pl/">Tomek WÃ³jcik</a>. Since it
borrows code from Werkzeug, it's licensed under the BSD license.</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>